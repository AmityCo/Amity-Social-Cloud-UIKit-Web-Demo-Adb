# UiKit for Web contribution guide

## Requirements

- git
- nodejs

## Pre-setup

1. Add this line to your `.bashrc` (or `.zshrc` in case you use `Oh My Zsh`)
   `export NPM_FONT_AWESOME_TOKEN=<token_value>`
   The `token_value` can be acquired from your fellow collegues or from GitLab `ui-kit` CI/CD variables.
2. Restart your terminal.

## Getting started

1. `git clone git@gitlab.com:upstra/web/ui-kit.git`
2. `cd ui-kit`
3. `npm ci`
4. `npm run storybook`

## Contribution flow

1. `git checkout origin/develop && git checkout -b feature/UKT-xxx`
2. Do some magic ~
3. `git push origin`
4. Submit your PR and attach labels "Awaiting review" and "Awaiting QA"
5. Pass your ticket to "Ready to QA" in JIRA
6. When the code review is validated, the reviewer will remove the "Awaiting review" label. If there is no other label left, the reviewer will add the label "To be Merged"
7. When the QA validates the feature, **you** will remove the "Awaiting QA" label. If there is no other label left, **you** should add the label "To be Merged"

Whenever appropriate, the "To be merged" shall be merged at once.

### Commits and Changelog

Changelog will be auto-generated by commit log at every new version published.
To add commits in the different categories of the changelog, prefix your commit log with:

- `break:`: breaking change
- `feat:`: new feature
- `fix:`: bugfix

## About Storybook

[Storybook](https://storybook.js.org/) is a web application which provides a safe and independent environment to build isolated, testable components and user journey.

In the context of Ui-Kit, we use it in development phase to deploy faster, QA phase to test in isolated context, and production phase as documentation and show-case tool.

### How to work with Storybook

When creating a component, simply create a `Component.stories.js` file containing your storybook stories. More on how to write stories [here](https://storybook.js.org/docs/react/writing-stories/introduction). We have installed the plugins `controls` and `actions`, so make sure you use them wisely.

## Debugging SDK

### 1. Preparing eko-sdk

1. `git checkout git@gitlab.com:upstra/web/sdk.git`
2. `cd sdk`
3. `npm install`
4. `npm run build:prod`
5. `npm link`
6. Run `nvm current` and note which version of node you're running

### 2. Linkage to Ui-Kit

In your local upstra-uikit:

1. `nvm use {version}` with the corresponding eko-sdk node version (from previous step â†‘)
2. `npm uninstall eko-sdk` (to uninstall npmjs.com version of eko-sdk)
3. `npm link eko-sdk` (to link eko-sdk in node_modules to local build)
4. `git checkout package*` (to silently cancel the linkage process in git)

### 3. Running

With this installation process done, whenever you make a modification in eko-sdk, simply run `npm run build:prod` and let ui-kit storybook rebuild itself after. You should see your modifications and console.log appear.

### Bug when committing

SDK currently runs and builds on nodejs v10.1 ; this can conflict with lint-staged and husky on ui-kit which are expecting a node version newer than 10.3 to run. Until this is fixed, you will have no choice but to switch node runtimes back and forth between a modern nodejs version and sdk's one. Refer to https://gitlab.com/upstra/web/sdk/-/merge_requests/44 for the progression of the resolution of this bug.

## Publishing

The publication of the library is entirely automated and controlled by CI. To publish a version, the only necessary command is `npm version` with the according version increment, as per `semver` semantics (`major`, `minor`, `patch`). **The patches can be released freely but the minor and major must be approved by a project manager before release.**

## Code syntax (project specific rules)

### Functional component declaration

UI Kit requires using `arrow function` syntax for functional components declaration (**consistency**):

```
// Correct
const Example = props => {
  return <div />;
}

// Wrong
function Example(props) {
  return <div />;
}
```
